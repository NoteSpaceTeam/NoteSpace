  on:
    push:
      branches:
        - main
  jobs:
    client:
      strategy:
        matrix:
          os: [ubuntu-latest]
          pnpm: ['latest']
          node: ['latest']
          working-directory: [code/client]


      runs-on: ${{ matrix.os }}
      defaults:
        run:
          working-directory: ${{ matrix.working-directory }}
      steps:
        - uses: actions/checkout@v4
        - uses: pnpm/action-setup@v3
          with:
            version: ${{ matrix.pnpm }}
        
        - name: Set up Node.js
          uses: actions/setup-node@v4
          with:
            node-version: ${{ matrix.node }}
            cache: 'pnpm'
            cache-dependency-path: |
              ./code/client/package.json
              ./code/client/pnpm-lock.yaml

        - name: Install dependencies
          run: pnpm install

        - name: Test client
          run: pnpm test

        - name: Format client
          run: pnpm format

    server:
      runs-on: ubuntu-latest
      strategy:
        matrix:
          os: [ubuntu-latest]
          pnpm: ['latest']
          node: ['latest']
          working-directory: [code/server]
      defaults:
        run:
          working-directory: ${{ matrix.working-directory }}
      steps:
        - uses: actions/checkout@v4
        - uses: pnpm/action-setup@v3
          with:
            version: ${{ matrix.pnpm }}

        - name: Set up Node.js
          uses: actions/setup-node@v4
          with:
            node-version: ${{ matrix.node }}
            cache: 'pnpm'
            cache-dependency-path: |
              ./code/server/package.json
              ./code/server/pnpm-lock.yaml


        - name: Install dependencies
          run: pnpm install

        - name: Test server
          run: pnpm test

        - name: Format server
          run: pnpm format
    shared:
      runs-on: ubuntu-latest
      strategy:
        matrix:
          os: [ubuntu-latest]
          pnpm: ['latest']
          node: ['latest']
          working-directory: [code/shared]
      defaults:
        run:
          working-directory: ${{ matrix.working-directory }}
      steps:
        - uses: actions/checkout@v4
        - uses: pnpm/action-setup@v3
          with:
            version: ${{ matrix.pnpm }}
            
        - name: Set up Node.js
          uses: actions/setup-node@v4
          with:
            node-version: ${{ matrix.node }}
            cache: 'pnpm'
            cache-dependency-path: |
              ./code/shared/package.json
              ./code/shared/pnpm-lock.yaml

        - name: Install dependencies
          run: pnpm install

        # - name: Test shared
        #   run: pnpm test

        - name: Format shared
          run: pnpm format
